DROP TABLE Felhasznalo CASCADE CONSTRAINTS;
DROP TABLE Kedvezmeny CASCADE CONSTRAINTS;
DROP TABLE Jegy CASCADE CONSTRAINTS;
DROP TABLE Jarat CASCADE CONSTRAINTS;
DROP TABLE Vonat CASCADE CONSTRAINTS;
DROP TABLE Csatlakozas CASCADE CONSTRAINTS;
DROP TABLE Allomas CASCADE CONSTRAINTS;
DROP TABLE Vasarlas CASCADE CONSTRAINTS;
DROP TABLE Alkalmazott CASCADE CONSTRAINTS;
DROP TABLE Munkabeosztas CASCADE CONSTRAINTS;
DROP TABLE Szabadsag CASCADE CONSTRAINTS;


-- Felhasználó tábla
CREATE TABLE Felhasznalo (
    felhasznalonev VARCHAR2(50),
    jelszo VARCHAR2(256) NOT NULL,
    szuletesi_ido DATE NOT NULL,
    alkalmazott NUMBER(1) CHECK (alkalmazott IN (0,1)),
    administrator NUMBER(1) CHECK (administrator IN (0,1))
);

-- Kedvezmény tábla
CREATE TABLE Kedvezmeny (
    k_azonosito NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    nev VARCHAR2(100) NOT NULL,
    kedvezmeny_szazalek NUMBER(3) CHECK (kedvezmeny_szazalek BETWEEN 0 AND 100) -- BINARY_FLOAT **volt** a dokumentációba írva ehhez a mezőhöz mielőtt átírtam ott
);

-- Jegy tábla
CREATE TABLE Jegy (
    jegy_azonosito NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    nev VARCHAR2(100) NOT NULL,
    ar NUMBER NOT NULL,
    felhasznalhato NUMBER(3) CHECK (felhasznalhato BETWEEN 1 AND 365)
);

-- Járat tábla
CREATE TABLE Jarat (
    jarat_azonosito NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    indulas TIMESTAMP NOT NULL,
    cs_azonosito NUMBER,
    vonat_azonosito NUMBER
);

-- Vonat tábla
CREATE TABLE Vonat (
    vonat_azonosito NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    elso_osztalyu_helyek NUMBER NOT NULL,
    masod_osztalyu_helyek NUMBER NOT NULL
);

-- Csatlakozás tábla
CREATE TABLE Csatlakozas (
    cs_azonosito NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    idotartam NUMBER NOT NULL,
    hossz NUMBER NOT NULL,  -- BINARY_FLOAT **volt** a dokumentációba írva ehhez a mezőhöz mielőtt átírtam ott
    elso_a_azonosito NUMBER,
    masodik_a_azonosito NUMBER,
    jarat_azonosito NUMBER
);

-- Állomás tábla
CREATE TABLE Allomas (
    a_azonosito NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    nev VARCHAR2(100) NOT NULL,
    varos VARCHAR2(100) NOT NULL
);

-- Vásárlás tábla
CREATE TABLE Vasarlas (
    vasarlas_azonosito NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    idopont TIMESTAMP NOT NULL,
    felhasznalonev VARCHAR2(50),
    k_azonosito NUMBER,
    jegy_azonosito NUMBER,
    jarat_azonosito NUMBER
);

-- Alkalmazott tábla
CREATE TABLE Alkalmazott (
    a_azonosito NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    nev VARCHAR2(100) NOT NULL,
    beosztas VARCHAR2(50) NOT NULL,
    oraber NUMBER NOT NULL
);

-- Szabadság tábla
CREATE TABLE Szabadsag (
    sz_azonosito NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    mettol DATE NOT NULL,
    meddig DATE NOT NULL,
    a_azonosito NUMBER
);

-- Munkabeosztás tábla
CREATE TABLE Munkabeosztas (
    m_azonosito NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    milyen_nap DATE NOT NULL,
    kezdet NUMBER NOT NULL,
    veg NUMBER NOT NULL,
    a_azonosito NUMBER
);



-- Elsődleges és külső kulcsok hozzáadása
ALTER TABLE Felhasznalo ADD CONSTRAINT pk_felhasznalo PRIMARY KEY (felhasznalonev);
ALTER TABLE Kedvezmeny ADD CONSTRAINT pk_kedvezmeny PRIMARY KEY (k_azonosito);
ALTER TABLE Jegy ADD CONSTRAINT pk_jegy PRIMARY KEY (jegy_azonosito);
ALTER TABLE Jarat ADD CONSTRAINT pk_jarat PRIMARY KEY (jarat_azonosito);
ALTER TABLE Vonat ADD CONSTRAINT pk_vonat PRIMARY KEY (vonat_azonosito);
ALTER TABLE Csatlakozas ADD CONSTRAINT pk_csatlakozas PRIMARY KEY (cs_azonosito);
ALTER TABLE Allomas ADD CONSTRAINT pk_allomas PRIMARY KEY (a_azonosito);
ALTER TABLE Vasarlas ADD CONSTRAINT pk_vasarlas PRIMARY KEY (vasarlas_azonosito);
ALTER TABLE Alkalmazott ADD CONSTRAINT pk_alkalmazott PRIMARY KEY (a_azonosito);
ALTER TABLE Szabadsag ADD CONSTRAINT pk_szabadsag PRIMARY KEY (sz_azonosito);
ALTER TABLE Munkabeosztas ADD CONSTRAINT pk_munkabeosztas PRIMARY KEY (m_azonosito);


-- Külső kulcsok beállítása
ALTER TABLE Jarat ADD CONSTRAINT fk_jarat_csatlakozas FOREIGN KEY (cs_azonosito) REFERENCES Csatlakozas(cs_azonosito) ON DELETE SET NULL;
ALTER TABLE Jarat ADD CONSTRAINT fk_jarat_vonat FOREIGN KEY (vonat_azonosito) REFERENCES Vonat(vonat_azonosito) ON DELETE CASCADE;
ALTER TABLE Csatlakozas ADD CONSTRAINT fk_csatlakozas_allomas1 FOREIGN KEY (elso_a_azonosito) REFERENCES Allomas(a_azonosito) ON DELETE CASCADE;
ALTER TABLE Csatlakozas ADD CONSTRAINT fk_csatlakozas_allomas2 FOREIGN KEY (masodik_a_azonosito) REFERENCES Allomas(a_azonosito) ON DELETE CASCADE;
ALTER TABLE Vasarlas ADD CONSTRAINT fk_vasarlas_felhasznalo FOREIGN KEY (felhasznalonev) REFERENCES Felhasznalo(felhasznalonev) ON DELETE CASCADE;
ALTER TABLE Vasarlas ADD CONSTRAINT fk_vasarlas_kedvezmeny FOREIGN KEY (k_azonosito) REFERENCES Kedvezmeny(k_azonosito) ON DELETE SET NULL;
ALTER TABLE Vasarlas ADD CONSTRAINT fk_vasarlas_jegy FOREIGN KEY (jegy_azonosito) REFERENCES Jegy(jegy_azonosito) ON DELETE CASCADE;
ALTER TABLE Vasarlas ADD CONSTRAINT fk_vasarlas_jarat FOREIGN KEY (jarat_azonosito) REFERENCES Jarat(jarat_azonosito) ON DELETE CASCADE;
ALTER TABLE Szabadsag ADD CONSTRAINT fk_szabadsag_alkalmazott FOREIGN KEY (a_azonosito) REFERENCES Alkalmazott(a_azonosito) ON DELETE CASCADE;
ALTER TABLE Munkabeosztas ADD CONSTRAINT fk_munkabeosztas_alkalmazott FOREIGN KEY (a_azonosito) REFERENCES Alkalmazott(a_azonosito) ON DELETE CASCADE;



-- Triggerek
CREATE OR REPLACE TRIGGER kedvezmeny_trigger
BEFORE INSERT
ON Vasarlas
FOR EACH ROW
DECLARE
    kNev VARCHAR2(100);
    fEv NUMBER;
	fAlk NUMBER;
BEGIN
	SELECT nev INTO kNev FROM Kedvezmeny WHERE k_azonosito = :NEW.k_azonosito;
	SELECT floor(months_between(SYSDATE, CAST(szuletesi_ido AS DATE)) /12) INTO fEv FROM Felhasznalo WHERE felhasznalonev = :NEW.felhasznalonev;
	SELECT alkalmazott INTO fAlk FROM Felhasznalo WHERE felhasznalonev = :NEW.felhasznalonev;
	
    IF kNev = 'Diák' AND fEv > 18 THEN 
        :NEW.k_azonosito := NULL;
    ELSIF kNev = 'Nyugdíjas' AND fEv < 65 THEN
        :NEW.k_azonosito := NULL;
    ELSIF kNev = 'MÁK-ONYF' AND fAlk = 0 THEN 
        :NEW.k_azonosito := NULL;
    END IF;

END;
/


-- Munkabeosztás trigger, Jani

CREATE OR REPLACE TRIGGER beosztas_ellenorzes
BEFORE INSERT OR UPDATE OF kezdet, veg ON munkabeosztas
FOR EACH ROW
DECLARE
    v_szamlalo NUMBER;
BEGIN
    SELECT COUNT(*)
    INTO v_szamlalo
    FROM munkabeosztas
    WHERE a_azonosito = :NEW.a_azonosito
      AND milyen_nap = :NEW.milyen_nap
      AND m_azonosito != :NEW.m_azonosito
      AND (
          (:NEW.kezdet BETWEEN kezdet AND veg)
          OR (:NEW.veg BETWEEN kezdet AND veg)
          OR (kezdet BETWEEN :NEW.kezdet AND :NEW.veg)
      )
      AND (:NEW.rowid IS NULL OR ROWID != :NEW.ROWID); -- hogy UPDATE-nél ne önmagát nézze

    IF v_szamlalo > 0 THEN
        RAISE_APPLICATION_ERROR(-20001, 'Ütköző vagy átfedő beosztás létezik erre az alkalmazottra.');
    END IF;
END;
/







--Szabadság rögzítése tárolt eljárás

CREATE OR REPLACE PROCEDURE Uj_Szabadsag_Rogzitese (
    p_a_azonosito IN NUMBER,
    p_mettol IN DATE,
    p_meddig IN DATE
) AS
    v_count NUMBER;
BEGIN
    -- Ellenőrizzük, van-e átfedés
    SELECT COUNT(*) INTO v_count
    FROM Szabadsag
    WHERE a_azonosito = p_a_azonosito
      AND (
           (p_mettol BETWEEN mettol AND meddig)
        OR (p_meddig BETWEEN mettol AND meddig)
        OR (p_mettol <= mettol AND p_meddig >= meddig)
      );

    IF v_count > 0 THEN
        RAISE_APPLICATION_ERROR(-20001, 'Átfedő szabadság már létezik.');
    ELSE
        INSERT INTO Szabadsag (mettol, meddig, a_azonosito)
        VALUES (p_mettol, p_meddig, p_a_azonosito);
    END IF;
END;
/


--Alkalmazottak havi bérének kiszámítása, (Összetett?) lekérdezés

SELECT
  a.a_azonosito,
  a.nev,
  a.oraber,
  EXTRACT(YEAR FROM mb.milyen_nap) AS ev,
  EXTRACT(MONTH FROM mb.milyen_nap) AS honap,
  SUM((mb.veg - mb.kezdet) / 60) AS havi_orak,
  a.oraber * SUM((mb.veg - mb.kezdet) / 60) AS havi_ber
FROM
  Alkalmazott a
JOIN
  Munkabeosztas mb ON a.a_azonosito = mb.a_azonosito
GROUP BY
  a.a_azonosito, a.nev, a.oraber,
  EXTRACT(YEAR FROM mb.milyen_nap),
  EXTRACT(MONTH FROM mb.milyen_nap)
ORDER BY
  ev, honap, a.a_azonosito;






ALTER TRIGGER kedvezmeny_trigger ENABLE;
ALTER TRIGGER beosztas_ellenorzes ENABLE;

COMMIT;

INSERT INTO Felhasznalo VALUES ('Kis Béla', 'kisbela1', TO_DATE('1990-01-01', 'YYYY-MM-DD'), 1, 0);
INSERT INTO Felhasznalo VALUES ('Adminisztrátor Ármin', 'Adminvagyok', TO_DATE('1985-05-15', 'YYYY-MM-DD'), 1, 1);
INSERT INTO Felhasznalo VALUES ('Hát Izsák', 'Vicces00', TO_DATE('1995-07-20', 'YYYY-MM-DD'), 1, 0);
INSERT INTO Felhasznalo VALUES ('Vevő Evelin', 'VE12345', TO_DATE('2008-12-10', 'YYYY-MM-DD'), 0, 0);
INSERT INTO Felhasznalo VALUES ('Adminisztrátor Ádám', 'Testvér2', TO_DATE('1988-04-25', 'YYYY-MM-DD'), 1, 1);
INSERT INTO Felhasznalo VALUES ('Geiger Dániel', 'GEG123', TO_DATE('2003-04-10', 'YYYY-MM-DD'), 0, 0);
INSERT INTO Felhasznalo VALUES ('Macska Alexandra', 'maxaxa343', TO_DATE('2002-10-21', 'YYYY-MM-DD'), 0, 0);
INSERT INTO Felhasznalo VALUES ('Macska Sándor', 'masand434', TO_DATE('2009-10-21', 'YYYY-MM-DD'), 0, 0);
INSERT INTO Felhasznalo VALUES ('Szabó Tamás', 'Goated12312', TO_DATE('1947-08-13', 'YYYY-MM-DD'), 0, 0);
INSERT INTO Felhasznalo VALUES ('Orbán Viktor', 'O1G', TO_DATE('1960-11-11', 'YYYY-MM-DD'), 0, 0);
INSERT INTO Felhasznalo VALUES ('asd', 'scrypt:32768:8:1$W6Un2OWiKJpqYzSe$67f2a346b1ac9d17fa2b06cc56dd37b0a9493af21d81a849adcbc5592b4c335157d9f74644f4eeb3f5e802545f478bbbe2d16160c3f601baeb982da2d00c61a6', TO_DATE('1995-01-10', 'YYYY-MM-DD'), 0, 1);
INSERT INTO Felhasznalo VALUES ('Nagy Hanna', 'scrypt:32768:8:1$9XoYpuqISvspZfgD$3f342dd98cbac8519e5ae86d6b096544170e363fd651426c6077bce9213928fe46cd341f161adb660d0a57cff1262ffbfb368b9fb0a9c98cae513e11a2ecd872', TO_DATE('1990-10-19', 'YYYY-MM-DD'), 0, 0);
INSERT INTO Felhasznalo VALUES ('Kis Anna', 'scrypt:32768:8:1$MdLmkuKSax0KhUxn$7c3d2908e0456b4aefc4750f9909858a3f1596a9fdc4e20be4e0352ac1cf7b4a4a7b3e3b87bbe913b384588148d0ea8f3f36fc69c6106b0d225adb763f2dd9db', TO_DATE('2003-01-21', 'YYYY-MM-DD'), 0, 0);
INSERT INTO Felhasznalo VALUES ('Pató Pál', 'scrypt:32768:8:1$eaUbnE913jHTWgAs$1a018039b32264d8cd028b91050d4fc33152d940212373e22ebc814b0e84bbb357c63d91b86628fca015b518aa9887b3a1afe52bd17a59d628536645d125c7e7', TO_DATE('1977-05-01', 'YYYY-MM-DD'), 0, 0);
INSERT INTO Felhasznalo VALUES ('Kató Katalin', 'scrypt:32768:8:1$ljunH5jGIEgcjtja$74ea4df3a79175b69afedda8846808bf758ab7e17c668f8131eec653cac90f0e87bbfa950ed7e432cf37ca6e4aeab774c9499711b1a74ea49f3d057b49646da9', TO_DATE('1993-07-30', 'YYYY-MM-DD'), 0, 0);
INSERT INTO Felhasznalo VALUES ('Mammama Miklós', 'scrypt:32768:8:1$lzEMsKhoysPsUyAa$3f720ce58f4013c7cb21ebbde9be40d1c02d6502fc7df855153a524a4dccd77d5abff2224a157822b0618d9ba458deffe5beeb760882176d095da0d5f94fe66f', TO_DATE('1964-08-08', 'YYYY-MM-DD'), 0, 0);
INSERT INTO Felhasznalo VALUES ('Gara Gábor', 'scrypt:32768:8:1$af3kXbAW7azQ5C4g$04780269974417afd5185f282a1220ce4eb992b821fc4eac062f10d21aea29b3fbdeed3cadec982397a44c74e9a6bd9c8afb01d5e24a0a6e68b9ef4d1c44a47b', TO_DATE('1969-12-05', 'YYYY-MM-DD'), 0, 0);
INSERT INTO Felhasznalo VALUES ('Lakatos Teofil', 'scrypt:32768:8:1$Jp341lU502KwsFMA$0599cd7060347ccd52b41e868410b443ace7d8b16393943dae50df9df4bff9a0e9bcfa9cdee26e7604c38b5f87a7f9c5c07ff13325ea0dfdf2139f983a8eed2c', TO_DATE('1996-03-12', 'YYYY-MM-DD'), 0, 0);
INSERT INTO Felhasznalo VALUES ('Vak Béla', 'scrypt:32768:8:1$SOKYmKkYAa46ZpEM$d74cf65c19f5f2c9ef5004557d2170d68b6679aaada7a18ede975c00641f54319a19eaee5f9e1d5447c7a8320e6b345980d3c73fd66ca3d8975baa82b37c4acb', TO_DATE('1947-06-06', 'YYYY-MM-DD'), 0, 0);
INSERT INTO Felhasznalo VALUES ('Liptai Dávid', 'scrypt:32768:8:1$iNOvfS1X48FLhpnA$0e46de5613fed8fde67d51acebcc5dae5cb6e68bd550b8964c687fa20aaf9471f2c4745784e4882b304feeeeeab01320922953660ce2fd8592e31427a5361292', TO_DATE('2000-10-22', 'YYYY-MM-DD'), 0, 0);
INSERT INTO Felhasznalo VALUES ('Szellő István', 'scrypt:32768:8:1$SHDAZVH7DUQs1jKm$b31161fff6dcf2fe6c5b48e70a35ba1d1266e20c8c0c690ebf75d04d9a63a7469ba583c839f038e909f8392e2c4d4c1e5077ec53222622c5a4007245a2247176', TO_DATE('1960-02-20', 'YYYY-MM-DD'), 0, 0);
INSERT INTO Felhasznalo VALUES ('Erős Antónia', 'scrypt:32768:8:1$TZraeCSt9f6qnabs$15aea3d87bbee4506cebd148c2336ddfe3e68708cfb24cb778cdbd30acfe9fa24352186a184720232f8b7acad7ecedcbfe50ea423826637754e79ab3794f1113', TO_DATE('1970-04-03', 'YYYY-MM-DD'), 0, 0);


INSERT INTO Kedvezmeny (nev, kedvezmeny_szazalek) VALUES ('Diák', 50);
INSERT INTO Kedvezmeny (nev, kedvezmeny_szazalek) VALUES ('Nyugdíjas', 50);
INSERT INTO Kedvezmeny (nev, kedvezmeny_szazalek) VALUES ('Családi', 70);
INSERT INTO Kedvezmeny (nev, kedvezmeny_szazalek) VALUES ('Hétvégi', 70);
INSERT INTO Kedvezmeny (nev, kedvezmeny_szazalek) VALUES ('MÁK-ONYF', 10);

INSERT INTO Jegy (nev, ar, felhasznalhato) VALUES ('Másodosztály', 1000, 1);
INSERT INTO Jegy (nev, ar, felhasznalhato) VALUES ('Elsőosztály', 2000, 1);
INSERT INTO Jegy (nev, ar, felhasznalhato) VALUES ('Diák', 500, 1);
INSERT INTO Jegy (nev, ar, felhasznalhato) VALUES ('Nyugdíjas', 500, 1);
INSERT INTO Jegy (nev, ar, felhasznalhato) VALUES ('MÁK-ONYF', 100, 1);

--Régi vonatok
INSERT INTO Vonat (elso_osztalyu_helyek, masod_osztalyu_helyek) VALUES (50, 100);
INSERT INTO Vonat (elso_osztalyu_helyek, masod_osztalyu_helyek) VALUES (60, 120);
INSERT INTO Vonat (elso_osztalyu_helyek, masod_osztalyu_helyek) VALUES (70, 140);
INSERT INTO Vonat (elso_osztalyu_helyek, masod_osztalyu_helyek) VALUES (80, 160);
INSERT INTO Vonat (elso_osztalyu_helyek, masod_osztalyu_helyek) VALUES (90, 180);
--Új vonatok
INSERT INTO Vonat (elso_osztalyu_helyek, masod_osztalyu_helyek) VALUES (60, 110);
INSERT INTO Vonat (elso_osztalyu_helyek, masod_osztalyu_helyek) VALUES (70, 120);
INSERT INTO Vonat (elso_osztalyu_helyek, masod_osztalyu_helyek) VALUES (80, 130);
INSERT INTO Vonat (elso_osztalyu_helyek, masod_osztalyu_helyek) VALUES (90, 140);
INSERT INTO Vonat (elso_osztalyu_helyek, masod_osztalyu_helyek) VALUES (100, 150);
INSERT INTO Vonat (elso_osztalyu_helyek, masod_osztalyu_helyek) VALUES (55, 115);
INSERT INTO Vonat (elso_osztalyu_helyek, masod_osztalyu_helyek) VALUES (65, 135);
INSERT INTO Vonat (elso_osztalyu_helyek, masod_osztalyu_helyek) VALUES (45, 105);
INSERT INTO Vonat (elso_osztalyu_helyek, masod_osztalyu_helyek) VALUES (85, 160);
INSERT INTO Vonat (elso_osztalyu_helyek, masod_osztalyu_helyek) VALUES (90, 150);


INSERT INTO Allomas (nev, varos) VALUES ('Budapest-Keleti', 'Budapest');
INSERT INTO Allomas (nev, varos) VALUES ('Debrecen', 'Debrecen');
INSERT INTO Allomas (nev, varos) VALUES ('Szeged', 'Szeged');
INSERT INTO Allomas (nev, varos) VALUES ('Győr', 'Győr');
INSERT INTO Allomas (nev, varos) VALUES ('Pécs', 'Pécs');

INSERT INTO Csatlakozas (idotartam, hossz, elso_a_azonosito, masodik_a_azonosito, jarat_azonosito) VALUES (30, 10, 1, 2, 1);
INSERT INTO Csatlakozas (idotartam, hossz, elso_a_azonosito, masodik_a_azonosito, jarat_azonosito)  VALUES (45, 20, 3, 4, 2);
INSERT INTO Csatlakozas (idotartam, hossz, elso_a_azonosito, masodik_a_azonosito, jarat_azonosito)  VALUES (60, 30, 5, 1, 3);
INSERT INTO Csatlakozas (idotartam, hossz, elso_a_azonosito, masodik_a_azonosito, jarat_azonosito)  VALUES (75, 40, 2, 3, 4);
INSERT INTO Csatlakozas (idotartam, hossz, elso_a_azonosito, masodik_a_azonosito, jarat_azonosito)  VALUES (90, 50, 4, 5, 5);

--Új járatok
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Jan-20 13:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 1, 1);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Jan-20 14:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 2, 2);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Jan-20 15:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 3, 3);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Jan-20 16:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 4, 4);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Jan-20 17:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 5, 5);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Feb-20 13:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 1, 1);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Feb-20 14:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 2, 2);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Feb-20 15:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 3, 3);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Feb-20 16:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 4, 4);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Feb-20 17:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 5, 5);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Mar-20 13:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 1, 1);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Mar-20 14:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 2, 2);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Mar-20 15:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 3, 3);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Mar-20 16:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 4, 4);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Mar-20 17:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 5, 5);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Apr-20 13:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 1, 1);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Apr-20 14:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 2, 2);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Apr-20 15:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 3, 3);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Apr-20 16:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 4, 4);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Apr-20 17:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 5, 5);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-May-20 13:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 1, 1);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-May-20 14:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 2, 2);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-May-20 15:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 3, 3);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-May-20 16:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 4, 4);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-May-20 17:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 5, 5);
--Régi járatok
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-20 13:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 1, 1);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-20 14:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 2, 2);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-20 15:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 3, 3);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-20 16:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 4, 4);
INSERT INTO Jarat (indulas, cs_azonosito, vonat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-20 17:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 5, 5);

--Új vásárlások
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jan-01 13:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Vevő Evelin', 1, 1, 1);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jan-03 13:10:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 5, 2, 3);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jan-05 13:20:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jan-06 13:10:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 5, 2, 3);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jan-07 13:20:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jan-08 13:30:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Sándor', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jan-09 13:40:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Szabó Tamás', 2, 1, 5);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jan-11 13:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Vevő Evelin', 1, 1, 1);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jan-12 13:10:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 5, 2, 3);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jan-13 13:20:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jan-14 13:10:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 5, 2, 3);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jan-15 13:20:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jan-17 13:30:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Sándor', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jan-25 13:40:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Szabó Tamás', 2, 1, 5);

INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-03 13:44:02', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Vak Béla', 2, 1, 5);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-04 11:44:14', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Vak Béla', 2, 1, 5);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-05 13:22:22', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Szabó Tamás', 2, 1, 5);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-06 10:50:13', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Szabó Tamás', 2, 1, 5);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-07 12:40:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Nagy Hanna', 3, 1, 5);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-08 10:11:42', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Vevő Evelin', 1, 1, 1);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-11 11:21:27', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Vevő Evelin', 1, 1, 1);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-12 12:32:02', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Nagy Hanna', 3, 1, 4);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-13 13:41:04', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Kis Anna', 1, 1, 1);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-14 14:52:15', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Kis Anna', 1, 1, 1);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-15 15:05:22', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Liptai Dávid', 4, 1, 1);



INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-23 13:44:02', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Vak Béla', 2, 1, 5);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-24 11:44:14', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Vak Béla', 2, 1, 5);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-25 13:22:22', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Szabó Tamás', 2, 1, 5);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-26 10:50:13', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Szabó Tamás', 2, 1, 5);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-27 12:40:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Szabó Tamás', 2, 1, 5);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-20 10:11:42', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Vevő Evelin', 1, 1, 1);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-21 11:21:27', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Vevő Evelin', 1, 1, 1);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-22 12:32:02', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Vevő Evelin', 1, 1, 1);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-23 13:41:04', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Kis Anna', 1, 1, 1);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-24 14:52:15', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Kis Anna', 1, 1, 1);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-25 15:05:22', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Kis Anna', 1, 1, 1);


INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Feb-01 13:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Vevő Evelin', 1, 1, 1);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Feb-02 13:10:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 5, 2, 3);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Feb-05 13:20:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Feb-06 13:10:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 5, 2, 3);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Feb-07 13:20:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Feb-08 13:30:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Sándor', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Feb-09 13:40:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Szabó Tamás', 2, 1, 5);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Feb-10 13:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Vevő Evelin', 1, 1, 1);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Feb-11 13:10:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 5, 2, 3);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Feb-12 13:20:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Feb-15 13:10:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 5, 2, 3);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Feb-17 13:20:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Feb-20 13:30:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Sándor', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Feb-20 13:40:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Szabó Tamás', 2, 1, 5);

INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Mar-02 13:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Vevő Evelin', 1, 1, 1);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Mar-03 13:10:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 5, 2, 3);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Mar-05 13:20:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Mar-06 13:30:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Sándor', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Mar-07 13:40:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Szabó Tamás', 2, 1, 5);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Mar-08 13:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Vevő Evelin', 1, 1, 1);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Mar-09 13:10:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 5, 2, 3);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Mar-10 13:20:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Mar-16 13:30:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Sándor', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Mar-18 13:40:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Szabó Tamás', 2, 1, 5);

INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Apr-05 13:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Vevő Evelin', 1, 1, 1);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Apr-05 13:10:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 5, 2, 3);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Apr-07 13:20:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Apr-08 13:10:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 5, 2, 3);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Apr-10 13:20:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Apr-11 13:30:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Sándor', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Apr-12 13:40:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Szabó Tamás', 2, 1, 5);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Apr-13 13:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Vevő Evelin', 1, 1, 1);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Apr-13 13:10:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 5, 2, 3);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Apr-14 13:20:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Apr-15 13:10:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 5, 2, 3);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Apr-16 13:20:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Apr-17 13:30:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Sándor', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Apr-19 13:40:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Szabó Tamás', 2, 1, 5);

INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-May-02 13:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Vevő Evelin', 1, 1, 1);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-May-03 13:10:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 5, 2, 3);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-May-03 13:20:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-May-06 13:30:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Sándor', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-May-07 13:40:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Szabó Tamás', 2, 1, 5);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-May-10 13:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Vevő Evelin', 1, 1, 1);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-May-11 13:10:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 5, 2, 3);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-May-12 13:20:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-May-16 13:30:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Sándor', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-May-18 13:40:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Szabó Tamás', 2, 1, 5);

INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-05 13:00:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Vevő Evelin', 1, 1, 1);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-05 13:10:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Orbán Viktor', 5, 2, 3);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-14 13:20:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-15 13:20:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-16 13:20:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Alexandra', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-17 13:30:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Macska Sándor', 1, 2, 2);
INSERT INTO Vasarlas (idopont, felhasznalonev, k_azonosito, jegy_azonosito, jarat_azonosito) VALUES (TO_TIMESTAMP('2025-Jun-19 13:40:10', 'YYYY-Mon-DD HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'), 'Szabó Tamás', 2, 1, 5);


INSERT INTO Alkalmazott (nev, beosztas, oraber) VALUES ('Kovács János', 'Jegyellenőr', 2000);
INSERT INTO Alkalmazott (nev, beosztas, oraber) VALUES ('Nagy Péter', 'Mozdonyvezető', 3000);
INSERT INTO Alkalmazott (nev, beosztas, oraber) VALUES ('Szabó Anna', 'Pénztáros', 1800);
INSERT INTO Alkalmazott (nev, beosztas, oraber) VALUES ('Tóth Béla', 'Karbantartó', 2200);
INSERT INTO Alkalmazott (nev, beosztas, oraber) VALUES ('Varga Erika', 'Diszpécser', 2500);


INSERT INTO Szabadsag (mettol, meddig, a_azonosito) VALUES (TO_DATE('2024-04-01', 'YYYY-MM-DD'), TO_DATE('2024-04-10', 'YYYY-MM-DD'), 1);
INSERT INTO Szabadsag (mettol, meddig, a_azonosito) VALUES (TO_DATE('2024-04-11', 'YYYY-MM-DD'), TO_DATE('2024-04-20', 'YYYY-MM-DD'), 2);
INSERT INTO Szabadsag (mettol, meddig, a_azonosito) VALUES (TO_DATE('2024-04-21', 'YYYY-MM-DD'), TO_DATE('2024-04-30', 'YYYY-MM-DD'), 3);
INSERT INTO Szabadsag (mettol, meddig, a_azonosito) VALUES (TO_DATE('2024-05-01', 'YYYY-MM-DD'), TO_DATE('2024-05-10', 'YYYY-MM-DD'), 4);
INSERT INTO Szabadsag (mettol, meddig, a_azonosito) VALUES (TO_DATE('2024-05-11', 'YYYY-MM-DD'), TO_DATE('2024-05-20', 'YYYY-MM-DD'), 5);
INSERT INTO Szabadsag (mettol, meddig, a_azonosito) VALUES (TO_DATE('2025-05-10', 'YYYY-MM-DD'), TO_DATE('2025-05-20', 'YYYY-MM-DD'), 5);


INSERT INTO Munkabeosztas (milyen_nap, kezdet, veg, a_azonosito) VALUES (DATE '2025-04-06', 480, 960, 1);
INSERT INTO Munkabeosztas (milyen_nap, kezdet, veg, a_azonosito) VALUES (DATE '2025-04-07', 480, 960, 2);
INSERT INTO Munkabeosztas (milyen_nap, kezdet, veg, a_azonosito) VALUES (DATE '2025-04-08', 480, 960, 3);
INSERT INTO Munkabeosztas (milyen_nap, kezdet, veg, a_azonosito) VALUES (DATE '2025-04-09', 480, 960, 4);
INSERT INTO Munkabeosztas (milyen_nap, kezdet, veg, a_azonosito) VALUES (DATE '2025-04-10', 480, 960, 5);
INSERT INTO Munkabeosztas (milyen_nap, kezdet, veg, a_azonosito) VALUES (DATE '2025-04-11', 480, 960, 1);



COMMIT;



-- (eladás - kiadás) = nyereseg/veszteseg Éves kimutatás Jani

SELECT
    -- Dolgozói költség kiszámítása (ledolgozott órák × órabér)
    (SELECT SUM(
        (mb.veg - mb.kezdet) * a.oraber
    )
     FROM Munkabeosztas mb
     JOIN Alkalmazott a ON mb.a_azonosito = a.a_azonosito
     WHERE EXTRACT(YEAR FROM mb.milyen_nap) = TO_NUMBER(TO_CHAR(SYSDATE, 'YYYY'))
    ) AS dolgozoi_koltseg,

    -- Jegybevétel kiszámítása (jegy ára × (1 - kedvezmény))
    (SELECT SUM(
        j.ar * (1 - NVL(k.kedvezmeny_szazalek, 0)/100)
    )
     FROM Vasarlas v
     JOIN Jegy j ON v.jegy_azonosito = j.jegy_azonosito
     LEFT JOIN Kedvezmeny k ON v.k_azonosito = k.k_azonosito
     WHERE EXTRACT(YEAR FROM v.idopont) = TO_NUMBER(TO_CHAR(SYSDATE, 'YYYY'))
    ) AS jegy_bevetel,

    -- Nyereség = Jegybevétel - dolgozói költség
    (
      (SELECT SUM(
          j.ar * (1 - NVL(k.kedvezmeny_szazalek, 0)/100)
      )
       FROM Vasarlas v
       JOIN Jegy j ON v.jegy_azonosito = j.jegy_azonosito
       LEFT JOIN Kedvezmeny k ON v.k_azonosito = k.k_azonosito
       WHERE EXTRACT(YEAR FROM v.idopont) = TO_NUMBER(TO_CHAR(SYSDATE, 'YYYY'))
      )
      -
      (SELECT SUM(
          (mb.veg - mb.kezdet) * a.oraber
      )
       FROM Munkabeosztas mb
       JOIN Alkalmazott a ON mb.a_azonosito = a.a_azonosito
       WHERE EXTRACT(YEAR FROM mb.milyen_nap) = TO_NUMBER(TO_CHAR(SYSDATE, 'YYYY'))
      )
    ) AS nyereseg
FROM dual;



--Trigger, hogy ne lehessen véletlen ugyanarra a napra egy személynek szabit felvenni
CREATE OR REPLACE TRIGGER szabadsag_duplikacio_ellenorzes_trigger
BEFORE INSERT OR UPDATE ON Szabadsag
FOR EACH ROW
DECLARE
    van_egyezes NUMBER;
BEGIN
    SELECT COUNT(*) INTO van_egyezes
    FROM Szabadsag
    WHERE a_azonosito = :NEW.a_azonosito
      AND (
            (:NEW.mettol BETWEEN mettol AND meddig) OR
            (:NEW.meddig BETWEEN mettol AND meddig) OR
            (mettol BETWEEN :NEW.mettol AND :NEW.meddig) OR
            (meddig BETWEEN :NEW.mettol AND :NEW.meddig)
          )
      AND sz_azonosito != :NEW.sz_azonosito; -- Saját rekord kivétele UPDATE esetén

    IF van_egyezes > 0 THEN
        RAISE_APPLICATION_ERROR(-20001, 'Ez az alkalmazott már rendelkezik szabadsággal ezen a napon vagy átfedésben.');
    END IF;
END;
/


ALTER TRIGGER szabadsag_duplikacio_ellenorzes_trigger ENABLE;
COMMIT;



CREATE OR REPLACE PACKAGE tipusok_pkg AS
    TYPE stat_cursor IS REF CURSOR;
END tipusok_pkg;
/

CREATE OR REPLACE PROCEDURE Felhasznalo_Kedvezmeny_Statisztika (
    p_eredmeny OUT tipusok_pkg.stat_cursor
) AS
BEGIN
    OPEN p_eredmeny FOR
        SELECT
            f.felhasznalonev,
            k.nev AS kedvezmeny_nev,
            COUNT(*) AS hasznalatok_szama
        FROM
            Vasarlas v
        JOIN Felhasznalo f ON v.felhasznalonev = f.felhasznalonev
        JOIN Kedvezmeny k ON v.k_azonosito = k.k_azonosito
        GROUP BY
            f.felhasznalonev, k.nev
        ORDER BY
            f.felhasznalonev, hasznalatok_szama DESC;
END;
/


SET SERVEROUTPUT ON;
VARIABLE rc REFCURSOR;

BEGIN
    Felhasznalo_Kedvezmeny_Statisztika(:rc);
END;
/

PRINT rc;

COMMIT;
